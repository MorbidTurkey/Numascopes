{% extends "base.html" %}

{% block title %}Dashboard - Turkey Palm Readings{% endblock %}

{% block content %}
<!-- User Dashboard -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4><i class="fas fa-sun"></i> Your Daily Horoscope</h4>
                <small>{{ moment().format('MMMM Do, YYYY') }}</small>
            </div>
            <div class="card-body">
                {% if horoscope %}
                    {% if enhanced_data %}
                        <!-- Enhanced Daily Horoscope Display -->
                        <div class="enhanced-horoscope">
                            <!-- Top Card - Today at a Glance -->
                            <div class="glance-card mb-4 p-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div>
                                        <h5 class="mb-1">Today's Energy</h5>
                                    </div>
                                    <div class="text-end">
                                        <i class="fas fa-info-circle" 
                                           data-bs-toggle="tooltip" 
                                           data-bs-html="true"
                                           data-bs-placement="left"
                                           title="<strong>🌞 Mood Bar Meaning Scale</strong><br><br><strong>General Rule:</strong> All bars show relative energetic tone for today compared to your personal baseline — not success or failure.<br><br><strong>Full (High)</strong> → favorable, smooth flow, clear confidence.<br><strong>Half (Medium)</strong> → balanced, stable, or neutral; effort pays off normally.<br><strong>Low</strong> → tense, introspective, or low-energy day; pace yourself."
                                           style="font-size: 1.5rem; opacity: 0.8; cursor: help;"></i>
                                    </div>
                                </div>
                                
                                <!-- Mood Bars - Top Row -->
                                <div class="mood-bars mb-3">
                                    <div class="row g-2 mb-3">
                                        <div class="col-6 col-md-3">
                                            <div class="mood-bar-item text-center">
                                                <div class="mood-icon mb-1" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>❤️ Love</strong><br><br><strong>🔴 Low:</strong> Emotions may feel private or unsettled; give space and avoid big relationship talks.<br><br><strong>🟡 Medium:</strong> Steady connection—normal ups and downs. Good for honest but calm exchanges.<br><br><strong>🟢 High:</strong> Warmth and openness flow easily; great day for bonding or meeting new people."
                                                     style="cursor: help;">❤️</div>
                                                <div class="mood-bar bg-white bg-opacity-25 rounded" style="height: 8px;" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>Love Energy: {{ (enhanced_data.mood_bars.love if enhanced_data.mood_bars else 70.5) }}%</strong><br><br>{% if (enhanced_data.mood_bars.love if enhanced_data.mood_bars else 70.5) >= 70 %}🟢 High energy - great for bonding{% elif (enhanced_data.mood_bars.love if enhanced_data.mood_bars else 70.5) >= 40 %}🟡 Balanced connection energy{% else %}🔴 Private, reflective energy{% endif %}">
                                                    <div class="mood-fill bg-white rounded" style="width: {{ enhanced_data.mood_bars.love if enhanced_data.mood_bars else 70.5 }}%; height: 100%;"></div>
                                                </div>
                                                <small class="d-block mt-1" style="font-size: 0.7rem;">Love</small>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="mood-bar-item text-center">
                                                <div class="mood-icon mb-1" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>💼 Career / Work</strong><br><br><strong>🔴 Low:</strong> Motivation dips or distractions high; routine tasks best.<br><br><strong>🟡 Medium:</strong> Solid productivity—steady pace, few surprises.<br><br><strong>🟢 High:</strong> Focus, drive, and confidence strong—tackle key goals or presentations."
                                                     style="cursor: help;">💼</div>
                                                <div class="mood-bar bg-white bg-opacity-25 rounded" style="height: 8px;" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>Career Energy: {{ (enhanced_data.mood_bars.career if enhanced_data.mood_bars else 65.5) }}%</strong><br><br>{% if (enhanced_data.mood_bars.career if enhanced_data.mood_bars else 65.5) >= 70 %}🟢 High focus and drive{% elif (enhanced_data.mood_bars.career if enhanced_data.mood_bars else 65.5) >= 40 %}🟡 Steady productivity{% else %}🔴 Low motivation day{% endif %}">
                                                    <div class="mood-fill bg-white rounded" style="width: {{ enhanced_data.mood_bars.career if enhanced_data.mood_bars else 65.5 }}%; height: 100%;"></div>
                                                </div>
                                                <small class="d-block mt-1" style="font-size: 0.7rem;">Career</small>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="mood-bar-item text-center">
                                                <div class="mood-icon mb-1" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>💰 Finances</strong><br><br><strong>🔴 Low:</strong> Be cautious with spending or impulsive decisions.<br><br><strong>🟡 Medium:</strong> Budget stable; normal day for purchases or planning.<br><br><strong>🟢 High:</strong> Positive flow or insight into earning/saving—green light for strategy."
                                                     style="cursor: help;">💰</div>
                                                <div class="mood-bar bg-white bg-opacity-25 rounded" style="height: 8px;" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>Financial Energy: {{ (enhanced_data.mood_bars.money if enhanced_data.mood_bars else 75.5) }}%</strong><br><br>{% if (enhanced_data.mood_bars.money if enhanced_data.mood_bars else 75.5) >= 70 %}🟢 Positive flow for earning/saving{% elif (enhanced_data.mood_bars.money if enhanced_data.mood_bars else 75.5) >= 40 %}🟡 Budget stable{% else %}🔴 Be cautious with spending{% endif %}">
                                                    <div class="mood-fill bg-white rounded" style="width: {{ enhanced_data.mood_bars.money if enhanced_data.mood_bars else 75.5 }}%; height: 100%;"></div>
                                                </div>
                                                <small class="d-block mt-1" style="font-size: 0.7rem;">Money</small>
                                            </div>
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <div class="mood-bar-item text-center">
                                                <div class="mood-icon mb-1" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>🧘 Wellness</strong><br><br><strong>🔴 Low:</strong> Energy or mood may dip—rest, hydrate, and slow your pace.<br><br><strong>🟡 Medium:</strong> Balanced tone; maintain routines without pushing limits.<br><br><strong>🟢 High:</strong> Vitality and mood boosted—great for exercise or self-care."
                                                     style="cursor: help;">🧘</div>
                                                <div class="mood-bar bg-white bg-opacity-25 rounded" style="height: 8px;" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>Wellness Energy: {{ (enhanced_data.mood_bars.wellness if enhanced_data.mood_bars else 60.5) }}%</strong><br><br>{% if (enhanced_data.mood_bars.wellness if enhanced_data.mood_bars else 60.5) >= 70 %}🟢 Vitality and mood boosted{% elif (enhanced_data.mood_bars.wellness if enhanced_data.mood_bars else 60.5) >= 40 %}🟡 Balanced energy{% else %}🔴 Rest and slow your pace{% endif %}">
                                                    <div class="mood-fill bg-white rounded" style="width: {{ enhanced_data.mood_bars.wellness if enhanced_data.mood_bars else 60.5 }}%; height: 100%;"></div>
                                                </div>
                                                <small class="d-block mt-1" style="font-size: 0.7rem;">Wellness</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Overall Energy Bar - Bottom Row (Larger) -->
                                    <div class="row justify-content-center">
                                        <div class="col-8 col-md-6">
                                            <div class="mood-bar-item text-center">
                                                <div class="mood-icon mb-2" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>⭐ Overall Energy</strong><br><br><strong>🔴 Low:</strong> A quieter, reflective day; let things unfold naturally.<br><br><strong>🟡 Medium:</strong> A normal rhythm day; moderate progress and calm emotions.<br><br><strong>🟢 High:</strong> Dynamic, inspired flow; lean into motivation and new ideas."
                                                     style="cursor: help; font-size: 1.3rem;">⭐</div>
                                                <div class="mood-bar bg-white bg-opacity-25 rounded" style="height: 12px;" 
                                                     data-bs-toggle="tooltip" 
                                                     data-bs-html="true"
                                                     title="<strong>Overall Energy: {{ (enhanced_data.mood_bars.overall_energy if enhanced_data.mood_bars else 68.5) }}%</strong><br><br>{% if (enhanced_data.mood_bars.overall_energy if enhanced_data.mood_bars else 68.5) >= 70 %}🟢 Dynamic, inspired flow{% elif (enhanced_data.mood_bars.overall_energy if enhanced_data.mood_bars else 68.5) >= 40 %}🟡 Normal rhythm day{% else %}🔴 Quieter, reflective day{% endif %}">
                                                    <div class="mood-fill bg-white rounded" style="width: {{ enhanced_data.mood_bars.overall_energy if enhanced_data.mood_bars else 68.5 }}%; height: 100%;"></div>
                                                </div>
                                                <small class="d-block mt-1" style="font-size: 0.8rem; font-weight: 500;">Overall Energy</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Main Horoscope Content -->
                            <div class="horoscope-content">
                                <style>
                                .horoscope-content ul li {
                                    color: inherit;
                                }
                                .horoscope-content p {
                                    color: inherit;
                                }
                                .horoscope-content .text-muted {
                                    opacity: 0.6;
                                }
                                </style>
                                {{ horoscope|safe }}
                            </div>
                        </div>
                    {% else %}
                        <!-- Regular Horoscope Display -->
                        <div class="horoscope-content">
                            {{ horoscope|safe }}
                        </div>
                    {% endif %}
                    
                    <hr>
                    <div class="text-end">
                        <button class="btn btn-outline-primary btn-sm" onclick="shareHoroscope()">
                            <i class="fas fa-share"></i> Share
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="saveHoroscope()">
                            <i class="fas fa-bookmark"></i> Save
                        </button>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-info-circle text-muted mb-3" style="font-size: 3rem;"></i>
                        <h5>Complete Your Profile</h5>
                        <p class="text-muted">Add your birth information to receive personalized horoscopes.</p>
                        <a href="{{ url_for('profile') }}" class="btn btn-primary">
                            <i class="fas fa-user-edit"></i> Update Profile
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Natal Chart Preview -->
        {% if natal_chart %}
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-pie"></i> Your Natal Chart</h5>
            </div>
            <div class="card-body text-center">
                <img src="{{ natal_chart }}" alt="Natal Chart" class="img-fluid rounded" style="max-height: 400px; max-width: 100%;">
                <div class="mt-3">
                    <a href="{{ url_for('natal_chart') }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-expand"></i> View Full Chart
                    </a>
                    <a href="{{ url_for('modern_astrology') }}" class="btn btn-outline-success btn-sm ms-1">
                        <i class="fas fa-star"></i> Modern Chart
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Quick Stats -->
        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="fas fa-chart-line"></i> Your Cosmic Journey</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="border-end">
                            <h4 class="text-primary">{{ readings_count }}</h4>
                            <small class="text-muted">Readings</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <h4 class="text-primary">{{ readings_count }}</h4>
                        <small class="text-muted">Chart Readings</small>
                    </div>
                </div>
                <hr>
                <div class="text-center">
                    <small class="text-muted">
                        Member since {{ moment(current_user.created_at).fromNow() }}
                    </small>
                </div>
            </div>
        </div>

        <!-- Premium Upgrade (if not premium) -->
        {% if not current_user.is_premium %}
        <div class="card mt-4 border-warning">
            <div class="card-header bg-warning text-dark">
                <h5><i class="fas fa-star"></i> Unlock Premium Features</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-3">
                    <li><i class="fas fa-check text-success"></i> Advanced chart analysis</li>
                    <li><i class="fas fa-check text-success"></i> Compatibility reports</li>
                    <li><i class="fas fa-check text-success"></i> Transit predictions</li>
                    <li><i class="fas fa-check text-success"></i> Priority support</li>
                </ul>
                <button class="btn btn-warning w-100">
                    <i class="fas fa-crown"></i> Upgrade to Premium
                </button>
            </div>
        </div>
        {% endif %}

        <!-- Upcoming Cosmic Events -->
        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="fas fa-moon"></i> Upcoming Cosmic Events</h5>
            </div>
            <div class="card-body">
                <div class="cosmic-events">
                    {% if cosmic_events %}
                        {% for event in cosmic_events %}
                        <div class="event-item mb-3">
                            <div class="d-flex align-items-center">
                                <div class="event-icon me-3">
                                    {% if event.type == 'new_moon' %}
                                        <i class="fas fa-circle text-dark"></i>
                                    {% elif event.type == 'full_moon' %}
                                        <i class="fas fa-circle text-warning"></i>
                                    {% elif event.type == 'retrograde' %}
                                        <i class="fas fa-undo text-danger"></i>
                                    {% elif event.type == 'equinox' %}
                                        <i class="fas fa-seedling text-success"></i>
                                    {% elif event.type == 'solstice' %}
                                        <i class="fas fa-sun text-warning"></i>
                                    {% else %}
                                        <i class="fas fa-star text-primary"></i>
                                    {% endif %}
                                </div>
                                <div class="event-details">
                                    <strong>{{ event.title }}</strong>
                                    <br><small class="text-muted">{{ event.date }}</small>
                                    <p class="mb-0 small">{{ event.description }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="event-item mb-3">
                            <div class="d-flex align-items-center">
                                <div class="event-icon me-3">
                                    <i class="fas fa-spinner text-primary"></i>
                                </div>
                                <div class="event-details">
                                    <strong>Cosmic Events Loading...</strong>
                                    <br><small class="text-muted">Calculating real-time data</small>
                                    <p class="mb-0 small">Real astronomical calculations in progress</p>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <div class="text-center mt-3">
                    <a href="{{ url_for('cosmic_calendar') }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-calendar"></i> View Full Calendar
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
// Share horoscope
function shareHoroscope() {
    if (navigator.share) {
        navigator.share({
            title: 'My Daily Horoscope',
            text: document.querySelector('.horoscope-content').textContent.trim(),
            url: window.location.href
        });
    } else {
        // Fallback - copy to clipboard
        const text = document.querySelector('.horoscope-content').textContent.trim();
        navigator.clipboard.writeText(text).then(() => {
            if (typeof CosmicInsights !== 'undefined' && CosmicInsights.showSuccessMessage) {
                CosmicInsights.showSuccessMessage('Horoscope copied to clipboard!');
            }
        });
    }
}

// Save horoscope
function saveHoroscope() {
    // This would typically save to user's favorites or bookmarks
    if (typeof CosmicInsights !== 'undefined' && CosmicInsights.showSuccessMessage) {
        CosmicInsights.showSuccessMessage('Horoscope saved to your favorites!');
    }
}
</script>
{% endblock %}